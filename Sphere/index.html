<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>3D Photo Sphere with Music & Animated Background</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    font-family: sans-serif;
  }

  /* ---------- HEART BACKGROUND ---------- */
  #bgAnimation {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    border: none;
    z-index: 0;
    pointer-events: none;
    transform: scale(1.3); /* ðŸ”¥ increase heart size */
    transform-origin: center;
    transition: opacity 0.5s ease;
    opacity: 0.9;
  }

  body.fullscreen-open #bgAnimation {
    opacity: 0.45;
  }

  /* ---------- THREE CANVAS ---------- */
  canvas {
    position: relative;
    z-index: 1;
  }

  /* ---------- FULLSCREEN IMAGE ---------- */
  #fullscreen {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10;
    cursor: pointer;
  }

  #fullscreen img {
    max-width: 95%;
    max-height: 95%;
    border-radius: 10px;
  }

  /* ---------- UI BUTTONS ---------- */
  #pauseButton, #musicButton {
    position: fixed;
    top: 15px;
    z-index: 20;
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 14px;
  }

  #pauseButton { left: 15px; }
  #musicButton { left: 150px; }

  #pauseButton:hover,
  #musicButton:hover {
    background: rgba(255,255,255,0.4);
  }

  /* ---------- LYRICS PANEL ---------- */
  #lyricsWrapper {
    position: fixed;
    top: 70px;
    left: 20px;
    width: 260px;
    height: 180px; /* adjustable */
    background: rgba(150,150,150,0.25);
    backdrop-filter: blur(8px);
    border-radius: 10px;
    padding: 10px;
    overflow-y: auto;
    z-index: 20;
  }

  #lyricsWrapper::-webkit-scrollbar {
    width: 6px;
  }

  #lyricsWrapper::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.35);
    border-radius: 4px;
  }

  #lyrics p {
    margin: 6px 0;
    white-space: pre-wrap;  /* âœ… preserves spaces */
    color: white;           /* âœ… force white text */
    opacity: 0.35;
    cursor: pointer;
    transition: opacity 0.3s ease;
    user-select: text;
  }

  #lyrics p.active {
    opacity: 1;
  }
</style>
</head>

<body>

<!-- HEART BACKGROUND -->
<iframe
  id="bgAnimation"
  src="heart/dist/index.html"
  frameborder="0"
  allow="autoplay">
</iframe>

<!-- FULLSCREEN IMAGE -->
<div id="fullscreen">
  <img />
</div>

<!-- UI -->
<button id="pauseButton">Pause Rotation</button>
<button id="musicButton">Play Music</button>

<audio id="bgMusic" src="music/mySong.mp3"></audio>

<div id="lyricsWrapper">
  <div id="lyrics"></div>
</div>

<script type="module">
import * as THREE from "https://esm.sh/three@0.160.0";
import { OrbitControls } from "https://esm.sh/three@0.160.0/examples/jsm/controls/OrbitControls.js";

/* ---------- THREE SETUP ---------- */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 1000);
camera.position.z = 12;

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setPixelRatio(devicePixelRatio);
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enablePan = false;
controls.minDistance = 4;
controls.maxDistance = 30;

scene.add(new THREE.AmbientLight(0xffffff, 1.2));

/* ---------- IMAGES ---------- */
const imageWidth = 1.6;
const imageHeight = 2.4;
const imageCount = 10;
const density = 2;
const radius = Math.sqrt((imageCount * imageWidth * imageHeight * density) / (4 * Math.PI));

const loader = new THREE.TextureLoader();
const imageMeshes = [];

function bendPlane(geo, r) {
  const p = geo.attributes.position;
  for (let i = 0; i < p.count; i++) {
    const x = p.getX(i);
    const y = p.getY(i);
    p.setZ(i, -(x*x + y*y) / (2.2 * r));
  }
  p.needsUpdate = true;
  geo.computeVertexNormals();
}

for (let i = 0; i < imageCount; i++) {
  const tex = loader.load(`photos/${i+1}.jpg`);
  tex.colorSpace = THREE.SRGBColorSpace;

  const mat = new THREE.MeshBasicMaterial({ map: tex, transparent: true });
  const geo = new THREE.PlaneGeometry(imageWidth, imageHeight, 20, 20);
  bendPlane(geo, radius);

  const mesh = new THREE.Mesh(geo, mat);

  const phi = Math.acos(1 - 2*(i+0.5)/imageCount);
  const theta = Math.PI * (1 + Math.sqrt(5)) * i;

  mesh.position.set(
    radius * Math.sin(phi) * Math.cos(theta),
    radius * Math.cos(phi),
    radius * Math.sin(phi) * Math.sin(theta)
  );

  mesh.lookAt(mesh.position.clone().multiplyScalar(2));
  scene.add(mesh);
  imageMeshes.push(mesh);
}

/* ---------- FULLSCREEN ---------- */
const raycaster = new THREE.Raycaster();
const pointer = new THREE.Vector2();

window.addEventListener("pointerdown", e => {
  pointer.x = (e.clientX / innerWidth) * 2 - 1;
  pointer.y = -(e.clientY / innerHeight) * 2 + 1;
  raycaster.setFromCamera(pointer, camera);
  const hit = raycaster.intersectObjects(imageMeshes)[0];
  if (hit) {
    document.body.classList.add("fullscreen-open");
    fullscreen.style.display = "flex";
    fullscreen.querySelector("img").src = hit.object.material.map.image.src;
  }
});

fullscreen.onclick = () => {
  fullscreen.style.display = "none";
  document.body.classList.remove("fullscreen-open");
};

/* ---------- MUSIC & LYRICS ---------- */
const bgMusic = document.getElementById("bgMusic");
const musicBtn = document.getElementById("musicButton");

musicBtn.onclick = () => {
  if (bgMusic.paused) {
    bgMusic.play();
    musicBtn.textContent = "Pause Music";
  } else {
    bgMusic.pause();
    musicBtn.textContent = "Play Music";
  }
};

const lyricsData=[
  { time: 0, text: "I Love you" }, 
  { time: 0.5, text: "....." }, 
  { time: 1, text: "Uski Aankhon mein faila Kajal, Baaton se Karti Ghayal" }, 
  { time: 1.5, text: "Saanson mein uska hi hai naam" }, 
  { time: 2, text: "Meri neendein udi hai jabse, tu aagayi jeevan me" }, 
  { time: 2.5, text: "Roshan tu karde mujhko aaj" }, 
  { time: 3.0, text: "....." }, 
  { time: 3.5, text: "Uski Aankhon mein faila Kajal, Baaton se Karti Ghayal" }, 
  { time: 4, text: "Saanson mein uska hi hai naam" }, 
  { time: 4.5, text: "Meri neendein udi hai jabse, tu aagayi jeevan me" }, 
  { time: 5, text: "Roshan tu karde mujhko aaj" }, 
  { time: 5.5, text: "....." }, 
  { time: 6, text: "Maana kabhi kabhi had se guzar jaata hu tere pyaar mein" }, 
  { time: 6.5, text: "....." }, 
  { time: 7, text: "....." }, 
  { time: 7.5, text: "....." }, 
  { time: 8, text: "....." }, 
  { time: 8.5, text: "....." },
];

const lyricsDiv = document.getElementById("lyrics");
lyricsData.forEach(l => {
  const p = document.createElement("p");
  p.textContent = l.text;
  p.onclick = () => bgMusic.currentTime = l.time;
  lyricsDiv.appendChild(p);
});

let allowAutoScroll = true;
let scrollTimeout;

lyricsWrapper.addEventListener("wheel", () => {
  allowAutoScroll = false;
  clearTimeout(scrollTimeout);
  scrollTimeout = setTimeout(() => allowAutoScroll = true, 5000);
});

function updateLyrics() {
  const t = bgMusic.currentTime;
  lyricsDiv.querySelectorAll("p").forEach((p, i) => {
    const active = t >= lyricsData[i].time &&
      t < (lyricsData[i+1]?.time ?? Infinity);
    p.classList.toggle("active", active);
    if (active && allowAutoScroll) {
      p.scrollIntoView({ block: "center", behavior: "smooth" });
    }
  });
}

/* ---------- ANIMATION ---------- */
let autoRotate = true;

pauseButton.onclick = () => {
  autoRotate = !autoRotate;
  pauseButton.textContent = autoRotate ? "Pause Rotation" : "Resume Rotation";
};

function animate() {
  requestAnimationFrame(animate);

  if (autoRotate) scene.rotation.y += 0.002;

  imageMeshes.forEach(m => {
    const camDir = new THREE.Vector3();
    camera.getWorldDirection(camDir);
    const toMesh = m.position.clone().sub(camera.position).normalize();
    m.material.opacity = THREE.MathUtils.clamp(camDir.dot(toMesh), 0.3, 1);
  });

  updateLyrics();
  controls.update();
  renderer.render(scene, camera);
}
animate();

addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>

</body>
</html>
